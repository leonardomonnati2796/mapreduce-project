# Dockerfile semplificato per evitare problemi con go mod download
FROM golang:1.19-alpine AS builder

WORKDIR /app

# Copia tutto il progetto
COPY . .

# Compila direttamente senza separare il download
RUN CGO_ENABLED=0 GOOS=linux go build -o mapreduce ./src

# --- Fase 2: Release ---
FROM alpine:latest
WORKDIR /root/

# Installa ca-certificates per HTTPS
RUN apk --no-cache add ca-certificates

COPY --from=builder /app/mapreduce .
COPY --from=builder /app/data ./data

CMD ["./mapreduce"]
